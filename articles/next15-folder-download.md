---
title: "Next.js 15ã§GitHubã®ãƒ•ã‚©ãƒ«ãƒ€ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’ä½œã£ãŸ"
emoji: "ğŸ“"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nextjs", "githubapi", "oauth"]
published: false
---

GitHubã‹ã‚‰OAuthèªè¨¼ã‚’é€šã˜ã¦ä»»æ„ã®ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚’Next.js 15ã‚’é€šã˜ã¦åˆ¶ä½œã—ãŸè¨˜äº‹ã§ã™ã€‚

## ã¯ã˜ã‚ã«

GitHubã§ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ•ã‚©ãƒ«ãƒ€ã ã‘ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«å–ã‚Šè¾¼ã¿ãŸã„ã£ã¦ã“ã¨ãŒå¶ã«ã‚ã‚Šã¾ã™ã‚ˆã­ï¼æ‰‹æ³•ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ãŒã€Codespacesã‚’ä½¿ã£ãŸéš›ã«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒ...

![alt text](/images/next15-folder-download/cannot-open.png)

ã“ã‚Œã‚’å‡ºã•ãšã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒé›£ã—ã„ã§ã™ã‚ˆã­...

ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹éš›ã«APIã‚­ãƒ¼ãŒã‚ã‚Œã°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã‹ã‚‰ã‚‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™ãŒã€ç™ºè¡Œã™ã‚‹æ‰‹é–“ãŒå¤§å¤‰...ã¨ã„ã†å‹•æ©Ÿã§ä»Šå›ã€ã€ŒSourceSnapã€ã¨ã„ã†åç§°ã§ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã—ãŸã€‚

- OAuthèªè¨¼ã«ã‚ˆã‚Šãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«ã‚‚å¯¾å¿œ
- URLã®ã‚³ãƒ”ãƒšã§ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹

ç­‰ã«æ„è­˜ã—ã¦ãŠã‚Šã¾ã™ã€‚

## è©²å½“ã‚µã‚¤ãƒˆ

@[card](https://ssnap.isirmt.com/)

https://github.com/isirmt/SourceSnap

## é¸å®šã—ãŸæŠ€è¡“

- Next.js: ã¤ã„ã«v15ã¸ãƒ¡ã‚¸ãƒ£ãƒ¼ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã€‚æœªçŸ¥æ•°ã§ã¯ã‚ã‚‹ã‚‚ã®ã®ä½“é¨“ã¨ã—ã¦ä½¿ç”¨ã€‚
- TailwindCSS: æœ€è¿‘ãŠæ°—ã«å…¥ã‚Šã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚`className`ã«ç›´æ¥æ›¸ãä»¥ä¸Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦å¾Œã‹ã‚‰ç‹¬ç«‹ã•ã›ã‚‹å‡¦ç½®ã«ã‚‚å‘ã„ã¦ã„ã‚‹ã€‚ãƒ—ãƒ¬ãƒ¼ãƒ³ã‹ã‚‰ã‚‚ç§»è¡Œã—ã‚„ã™ãé–‹ç™ºã‚³ã‚¹ãƒˆãŒä½ããªã‚‹ã¨æ€ã„å°å…¥ã€‚
- Vercel: Next.jsé–‹ç™ºå…ƒã®ã‚µãƒ¼ãƒ“ã‚¹ã€‚ã„ã¤ã®é–“ã«ã‹Productionã®ãƒ“ãƒ«ãƒ‰ã«ã‚‚ãƒŸãƒ‹ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã€è¤‡æ•°äººé–‹ç™ºã«ãŠã‘ã‚‹è¡¨ç¤ºã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹éš›ã‚‚å¯¾å¿œã—ã‚„ã™ããªã£ã¦ã„ã‚‹ã€‚

## èªè¨¼éƒ¨åˆ†

[NextAuth](https://next-auth.js.org/)ã®**v5**ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚v15ã§ã‚‚ç‰¹ã«äº‹æ•…ã¯ç™ºç”Ÿã›ãšå°å…¥å¯èƒ½ã§ã—ãŸã€‚

```bash
npm i next-auth@beta
```

### ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®å–å¾—

NextAuthã§æä¾›ã•ã‚Œã‚‹Sessionã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼å(login)ã‚„OAuthã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ã“ã‚Œã‚‰ã‚’TypeScriptã§ã‚¨ãƒ©ãƒ¼ãªãã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

```ts:/src/lib/auth.ts
import NextAuth, { Session } from 'next-auth';
import { AdapterUser } from 'next-auth/adapters';
import { JWT } from 'next-auth/jwt';
import GitHubProvider from 'next-auth/providers/github';

declare module 'next-auth' {
  // eslint-disable-next-line no-unused-vars
  interface Session {
    access_token?: string;
    user: AdapterUser;
  }
}

export const { handlers, auth, signIn, signOut } = NextAuth({
  trustHost: true,
  providers: [
    GitHubProvider({
      authorization: { params: { scope: 'repo read:org' } },
    }),
  ],
  callbacks: {
    // eslint-disable-next-line no-unused-vars
    async jwt({ token, user, account, profile }) {
      if (profile && account) {
        token.username = profile.login;
        token.access_token = account.access_token;
      }
      return token;
    },
    async session({ session, token }: { session: Session; token: JWT }) {
      session.user.id = token.username as string;
      session.access_token = token.access_token as string;
      return session;
    },
  },
});
```

ã¾ãšã¯ã€

```ts
declare module 'next-auth' {
  interface Session {
    access_token?: string;
    user: AdapterUser;
  }
}
```

Sessionã¨ã„ã†å‹å®šç¾©ã«`access_token`ã¨`user`ãŒè¿½åŠ ã§å…¥ã‚‹ã‚ˆã†ã«å®£è¨€ã—ã¾ã™ã€‚ã“ã‚Œã§eslintç’°å¢ƒä¸‹ã‚‚å•é¡Œãªãè¨˜è¿°ã§ãã¾ã™ã€‚

```ts
providers: [
  GitHubProvider({
    authorization: { params: { scope: 'repo read:org' } },
  }),
],
```

authorizationã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¯ã€ãƒªãƒã‚¸ãƒˆãƒªã¨çµ„ç¹”ã¸ã®èª­ã¿å–ã‚Šæ¨©é™ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã‚Œã§privateã‚‚æ¨©é™ãŒã‚ã‚Œã°å–å¾—ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

```ts
callbacks: {
  async jwt({ token, user, account, profile }) {
    if (profile && account) {
      token.username = profile.login;
      token.access_token = account.access_token;
    }
    return token;
  },
  async session({ session, token }: { session: Session; token: JWT }) {
    session.user.id = token.username as string;
    session.access_token = token.access_token as string;
    return session;
  },
},
```

ã“ã“ã§ã€åœ¨ã‚‹ã¹ãå ´æ‰€ã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’tokenã¸ä¸€åº¦æ¸¡ã—ã€sessionã«è¨˜éŒ²ã—ã¾ã™ã€‚

```ts:/src/app/api/auth/[...nextauth]/route.ts
import { handlers } from '@/lib/auth';

export const { GET, POST } = handlers;
```

## ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å–å¾—

å–å¾—ã—ãŸã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã§ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚GitHub APIã¨ã®ã‚„ã‚Šå–ã‚Šã«ã¯Octokitã‚’ä½¿ã„ã¾ã™ã€‚

> JavaScript ã‚’ä½¿ç”¨ã—ã¦ GitHub ã® REST API ã¨å¯¾è©±ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨˜è¿°ã™ã‚‹å ´åˆã€GitHub ã§ã¯ã€Octokit.js SDK ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ Octokit.js ã¯ GitHub ã«ã‚ˆã£ã¦ç®¡ç†ã•ã‚Œã¾ã™ã€‚ SDK ã«ã‚ˆã£ã¦ãƒ™ã‚¹ãƒˆ ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãŒå®Ÿè£…ã•ã‚Œã¦ãŠã‚Šã€JavaScript ã‚’ä½¿ç”¨ã—ã¦ REST API ã‚’ç°¡å˜ã«æ“ä½œã§ãã¾ã™ã€‚Octokit.js ã¯ã€æœ€æ–°ã®ã‚ã‚‰ã‚†ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã€Node.jsã€Deno ã§å‹•ä½œã—ã¾ã™ã€‚ Octokit.js ã«ã¤ã„ã¦è©³ã—ãã¯ã€Octokit.js ã® README ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
> *(å¼•ç”¨: <https://docs.github.com/ja/rest/guides/scripting-with-the-rest-api-and-javascript#about-octokitjs>)*

fetch APIã§ã‚‚å¯èƒ½ã§ã™ãŒã€typesãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ã‚Šéå¸¸ã«ãŠã™ã™ã‚ã§ã™ã€‚

@[card](https://www.npmjs.com/package/@octokit/rest)

Sessionã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã€octokitã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ã¾ã§ã‚’è¨˜ã—ã¾ã™ã€‚

```tsx
import { Session } from 'next-auth';
import { Octokit } from '@octokit/rest';

export default async function Page() {
  const session: Session | null = await auth();
  if (!session || !session.access_token) return <>failed to auth</>;

  const octokit =  new Octokit({ auth: session.access_token });

  return <>check console tab</>;
}
```

Octokitã¯`auth`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã—ã§ã‚‚ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆå¯èƒ½ã§ã™ãŒã€ãã®ã¾ã¾åˆ©ç”¨ã™ã‚‹ã¨åŒä¸€IPã«å¯¾ã™ã‚‹60å›/hã®åˆ¶é™ã«å¼•ã£ã‹ã‹ã‚‹ã®ã§æ³¨æ„ã€‚

@[card](https://docs.github.com/ja/rest/using-the-rest-api/rate-limits-for-the-rest-api)

æ¬¡ã«å–å¾—ã™ã‚‹ã¾ã§ã‚’æ›¸ãã¾ã™ã€‚

```ts
const response = await octokit.repos.getContent({
  owner, repo, path, ref,
});

console.log(response.data);
```

ã“ã‚Œã ã‘ã§ãƒªã‚¹ãƒˆã¨ã—ã¦å‡ºåŠ›ãŒå¯èƒ½ã§ã™ã€‚å‹æƒ…å ±ã®å®£è¨€ã«ã¤ã„ã¦ã¯`@octokit/types`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å°å…¥ã—ãŸå¾Œã€

```ts
import { Octokit } from '@octokit/rest';
import { GetResponseTypeFromEndpointMethod } from '@octokit/types';

type GitHubTreeContent = GetResponseTypeFromEndpointMethod<Octokit['repos']['getContent']>['data']
```

ã“ã‚Œã§æŒ‡å®šãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ã“ã“ã®æŒ‡å®šæ–¹æ³•ã¯ãƒ¡ã‚½ãƒƒãƒ‰ã¨åŒã˜åå‰ã§å‹ã‚’å‘¼ã³å‡ºã›ã¾ã™ã€‚

### ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤º

è¡¨ç¤ºã¯ã€é…åˆ—ã‹å¦ã‹ã‚’æ¡ä»¶åˆ†å²ã—ã¦ã‹ã‚‰`React.ReactNode`ã‚’è¿”ã™ã“ã¨ã§æ›¸ãã‚„ã™ããªã‚Šã¾ã™ã€‚

```tsx
// ãƒªã‚¹ãƒˆå½¢å¼ã§è¿”ã£ã¦ãã‚‹å ´åˆã¯åŸºæœ¬åŒã˜
const data = response.data;

return (
  <section>
    {Array.isArray(data) && (
      data.map((item) => (
        <div key={item.id}>{item.name}</div>
      ))
    )}
  </section>
);
```

## ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’è¡Œã†éç¨‹ã§CORSã¨ã¶ã¤ã‹ã£ã¦ã—ã¾ã†ãŸã‚ã€APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆã—ã¦å›é¿ã—ã¤ã¤èªè¨¼ã‚’ç¶­æŒã—ã¾ã™ã€‚

### ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ

`content.data`ã®è¦ç´ å†…ã«ã¯æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

```ts
type GitHubReposContent = {
  type: 'dir' | 'file' | 'submodule' | 'symlink';
  size: number;
  name: string;
  path: string;
  content?: string;
  sha: string;
  url: string;
  git_url: string | null;
  html_url: string | null;
  download_url: string | null;
  _links: {
    git: string | null;
    html: string | null;
    self: string;
  };
};
```

ã—ãŸãŒã£ã¦ã€`download_url`ã‚’æ¸¡ã™ã“ã¨ã§è¦ä»¶ã¯æº€ãŸã›ã¾ã™ã€‚ã¾ãšã¯ã€APIå´ã‹ã‚‰

```ts:/src/app/api/get-file/route.ts
import { Octokit } from '@octokit/rest';
import { NextResponse } from 'next/server';
import { Session } from 'next-auth';
import { auth } from '@/lib/auth';

export async function GET(request: Request) {
  const session: Session | null = await auth();

  if (!session) {
    return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });
  }
  const { searchParams } = new URL(request.url);
  const downloadUrl = searchParams.get('download_url');

  if (!downloadUrl) {
    return NextResponse.json({ error: 'Missing required parameters' }, { status: 400 });
  }

  try {
    const octokit = new Octokit({
      auth: session.access_token,
    });

    const response = await octokit.request('GET ' + downloadUrl);

    if (response.status !== 200) {
      throw new Error(`Failed to fetch the file: ${response.status}`);
    }

    const buffer = Buffer.from(response.data);

    return new NextResponse(buffer, {
      headers: {
        'Content-Type': 'application/octet-stream',
        'Content-Disposition': `attachment; filename="downloaded_file"`,
      },
    });
  } catch (error) {
    console.error('Error fetching the file:', error);
    return NextResponse.json({ error: 'Error Occurred' }, { status: 500 });
  }
}
```

`try...catch`ã¾ã§ãŒèªè¨¼ã®æœ‰ç„¡ã¨URLãŒæ¸¡ã•ã‚ŒãŸã‹ã®ç¢ºèªã€ãã‚Œä»¥é™ãŒ`octokit`ã«ã‚ˆã‚‹contentã®å–å¾—ã¨ãƒãƒƒãƒ•ã‚¡ã®ä½œæˆã§ã™ã€‚
ã“ã“ã§ã€NextAuthã®v5è¦ç´ ãŒç¾ã‚Œã¦ãŠã‚Šã€`req`ã‹ã‚‰ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèªã™ã‚‹ã®ã§ã¯ãªãã€`await auth()`ã¨ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å…±é€šã®è¨˜è¿°ãªéƒ¨åˆ†ã§ã™ã€‚

@[card](https://authjs.dev/getting-started/migrating-to-v5#authentication-methods)

ãã—ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã•ã›ã¾ã™ã€‚ä¿å­˜ã«ã¯ã€`file-saver`ã‚’ä½¿ã„ã¾ã™ã€‚

```bash
npm i file-saver
npm i --save @types/file-saver
```

```ts
import saveAs from 'file-saver';

try {
  if (download_url) {
    const response = await fetch(`/api/get-file?download_url=${encodeURIComponent(download_url)}`);
    if (!response.ok) {
      throw new Error('Failed to download file');
    }
    const blob = await response.blob();
    saveAs(blob, name);
  } else {
    throw new Error('File does not have a download URL.');
  }
} catch (error) {
  console.error('Failed to download file:', error);
}
```

### ãƒ•ã‚©ãƒ«ãƒ€ã®å ´åˆ

#### ãƒ•ã‚©ãƒ«ãƒ€ã‚’å†å¸°çš„ã«å–å¾—ã™ã‚‹

ã‚¿ã‚¤ãƒˆãƒ«ã®é€šã‚Šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®é…åˆ—ã‚’å–å¾—ã—ã€typeãŒdirã®å ´åˆã¯å†å¸°çš„ã«é…åˆ—ã¸è¿½åŠ ã—ã¦ã„ãæ‰‹æ³•ã§ã™ã€‚å…ˆè¿°ã®ç™ºå±•ç‰ˆãªã®ã§æ“ä½œã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚

zipåœ§ç¸®ã¾ã§è¡Œã„ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯`npm i jszip`ã§å°å…¥ã—ã¾ã™ã€‚

```ts:/src/app/api/get-folder/route.ts
import { Octokit } from '@octokit/rest';
import JSZip from 'jszip';
import { NextResponse } from 'next/server';
import { Session } from 'next-auth';
import { auth } from '@/lib/auth';
// é…åˆ—éƒ¨åˆ†ã®å‹ã®æŠ½å‡º
import { GitHubReposContext } from '@/types/GitHubReposContext';

export async function GET(request: Request) {
  const session: Session | null = await auth();

  if (!session) {
    return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });
  }

  const { searchParams } = new URL(request.url);
  const owner = searchParams.get('owner');
  const repo = searchParams.get('repo');
  const path = searchParams.get('path');
  const ref = searchParams.get('ref');

  if (!owner || !repo || !path) {
    return NextResponse.json({ error: 'Missing required parameters' }, { status: 400 });
  }

  try {
    const octokit = new Octokit({ auth: session.access_token });

    const files = await getFolderContents(octokit, owner, repo, path, ref);

    const zip = new JSZip();

    for (const file of files) {
      const fileContent = await octokit.request('GET ' + file.download_url);

      zip.file(file.path, fileContent.data);
    }

    const zipBlob = await zip.generateAsync({ type: 'blob' });

    return new NextResponse(zipBlob, {
      headers: {
        'Content-Type': 'application/zip',
        'Content-Disposition': `attachment; filename="${repo}.zip"`,
      },
    });
  } catch (error) {
    console.error('Error fetching the file:', error);
    return NextResponse.json({ error: 'Error Occurred' }, { status: 500 });
  }
}

async function getFolderContents(
  octokit: Octokit,
  owner: string,
  repo: string,
  path: string,
  ref: string,
): Promise<GitHubReposContext[]> {
  const contents = await octokit.repos.getContent({
    owner, repo, path, ref,
  });

  if (contents && Array.isArray(contents.data)) {
    const files: GitHubReposContext[] = [];
    for (const item of contents.data) {
      if (item.type === 'file') {
        files.push(item);
      } else if (item.type === 'dir') {
        const subfolderFiles = await getFolderContents(octokit, owner, repo, item.path, ref);
        files.push(...subfolderFiles);
      }
    }

    return files;
  } else return [];
}
```
