---
title: "ã€Next.js + GitHub APIã€‘ã‚·ãƒªãƒ¼ã‚ºãƒ»ã‚³ãƒ¡ãƒ³ãƒˆæœ‰ã‚Šã®ãƒ–ãƒ­ã‚°ã‚’ä½œæˆã—é‹ç”¨ã™ã‚‹"
emoji: "ğŸ²"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nextjs", "githubapi", "recaptcha", "blog"]
published: true
---

æŠ€è¡“ç­‰ã«å¯¾ã—ã¦ã¡ã‚‡ã£ã¨ã—ãŸè¨˜äº‹ã‚’æ›¸ãæ®‹ã›ã‚‹ãƒ–ãƒ­ã‚°ã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã—ãŸãã€ä½œæˆãƒ»ãƒªãƒªãƒ¼ã‚¹ã—ãŸãŸã‚ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨å…±ã«å®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦ã¾ã¨ã‚ã¾ã—ãŸã€‚è¨­è¨ˆã‹ã‚‰å®Ÿè£…ã€é‹ç”¨ã¾ã§æ›¸ããŸã‚é•·ããªã‚Šã¾ã™ã€‚

## çµè«–

æœ¬è¨˜äº‹ã®çµè«–ã¨ãªã‚‹ã‚µã‚¤ãƒˆãƒ»ãƒªãƒã‚¸ãƒˆãƒªã§ã™ã€‚

- HP

@[card](https://blog.isirmt.com)

- ãƒªãƒã‚¸ãƒˆãƒª

@[card](https://github.com/isirmt/NextjsBlogWithGitPAT)

## ç›®æ¨™ãƒ»è¨­è¨ˆ

### ç›®æ¨™

- PCã§è¨˜è¿°ã—ã‚„ã™ã„ Markdown(MD) å½¢å¼ãƒ–ãƒ­ã‚°
- ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ã«å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã—ã€ç”»åƒã‚‚å¯¾å¿œå¯
- æŠ•ç¨¿ã®ã‚·ãƒªãƒ¼ã‚ºåŒ–å¯¾å¿œ
- ã‚³ãƒ¡ãƒ³ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®è¨­å–¶
- ä½ã‚³ã‚¹ãƒˆãªã‚µã‚¤ãƒˆé‹å–¶

ã“ã‚Œã‚‰ã‚’1ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ã§å®Œçµã•ã›ã‚‹ã“ã¨ãŒç›®æ¨™ã§ã™ã€‚

### åˆ©ç”¨ã™ã‚‹æŠ€è¡“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã¨ç†ç”±

- **Vercel**

PaaS ã§ã™ã€‚GitHub ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã®é€£æºã‚„ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã®ç‚¹ã§ã¨ã¦ã‚‚åˆ©ç”¨ã—ã‚„ã™ã„ãŸã‚ã§ã™ã€‚

@[card](https://vercel.com)

- **Next.js**

React ãƒ™ãƒ¼ã‚¹ã® WEB ã‚¢ãƒ—ãƒªãŒæ§‹ç¯‰å¯èƒ½ã§ã™ã€‚Vercel ç®¡ç†ãªç‚¹ã‚„å‹•çš„ãƒšãƒ¼ã‚¸ç”ŸæˆãŒå®¹æ˜“ãªç‚¹ãŒä¸»ãªç†ç”±ã§ã™ã€‚

@[card](https://nextjs.org/)

- **GitHub API**

è‡ªèº«ã® GitHub ãƒªãƒã‚¸ãƒˆãƒªã¸ç™ºè¡Œã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã§ Public / Private ã«å•ã‚ãšã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚æ—¢ã«ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†ãŒã‚ã‚‹ç‚¹ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãŒå¯èƒ½ãªãŸã‚ã§ã™ã€‚

@[card](https://docs.github.com/ja/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens)

- **reCAPTCHA**

[ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã®è¨­è¨ˆ](#ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã®è¨­è¨ˆ)ã«ã¦å¾Œè¿°ã€‚

@[card](https://www.google.com/recaptcha)

- [**Tailwind CSS**](https://tailwindcss.com/): SCSS ã‚’ä½¿ã‚ãšè©¦ã—ã«ä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚

### è¨˜äº‹ã®ç®¡ç†æ–¹æ³•ã«ã¤ã„ã¦

GitHub ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã—ã¾ã—ãŸã€‚

```tree:è¨˜äº‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
â”œâ”€â”€ posts/
â”‚   â”œâ”€â”€ [ã‚·ãƒªãƒ¼ã‚ºå]/
â”‚   â”‚   â”œâ”€â”€ (meta.json)
â”‚   â”‚   â”œâ”€â”€ 1.md
â”‚   â”‚   â”œâ”€â”€ 2.md
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ è¨˜äº‹å.md
â”œâ”€â”€ img/
â”‚   â”œâ”€â”€ [ä»»æ„]
â”‚   â””â”€â”€ ä»»æ„
â””â”€â”€ profile/
    â””â”€â”€ index.md
```

[ç›®æ¨™](#ç›®æ¨™)ã‚ˆã‚Šã‚·ãƒªãƒ¼ã‚ºã®å®Ÿç¾ã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’åæ˜ ã™ã‚Œã°è§£æ±ºã ã¨è€ƒãˆã¾ã—ãŸã€‚ãŸã ã—ã€`title`ã‚„`description`ã¯ã‚ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚`meta.json`ã‚’ä»»æ„ã§é…ç½®å¯èƒ½ã«ã—ã¾ã™ã€‚

ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¯åŒã˜ MD å½¢å¼ã§çµ±ä¸€ã—ã¾ã™ã€‚ç”»åƒé…ç½®ã¯`posts`ã¨åŒã˜éšå±¤ã§ã€è¨˜è¿°æ™‚ã«ãƒ«ãƒ¼ãƒˆ`/`ã‹ã‚‰å‚ç…§ã™ã‚‹ã“ã¨ã§ VS Code ç­‰ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ãŒå¯¾å¿œå¯èƒ½ãªçŠ¶æ…‹ã«ã—ã¾ã™ã€‚

### ã‚µã‚¤ãƒˆä¸Šã®è¨˜äº‹ç®¡ç†

åŒã˜ãƒˆãƒ”ãƒƒã‚¯ã¯ã‚¿ã‚°ä»˜ã‘ã—ã¾ã™ã€‚ã¾ãšã€ä»Šå›ã®`.md`ã®ä¸Šéƒ¨ã«å…¥ã‚‹ YAML ãƒ˜ãƒƒãƒ€ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```md:example.md
---
title: "ã‚ã‘ã¾ã—ã¦ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™"
date: "2024/1/1"
tags: ["ãƒ–ãƒ­ã‚°","Next.js","Markdown","Tailwind CSS"]
---
ã“ã“ã‹ã‚‰æœ¬æ–‡
```

`title`ã ã‘ã¯å¿…é ˆåŒ–ã—ã¾ã™ã€‚ä»–ã¯`undefined`ã§ã‚‚å¯¾å¿œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ä»Šå›ã®ã‚¿ã‚°ç®¡ç†ã¯å…¨è§’æ–‡å­—ã‚„ã‚¹ãƒšãƒ¼ã‚¹ã«ã‚‚å¯¾å¿œã•ã›ã¾ã™ã€‚ã§ãªã„ã¨å¯¾å¿œè¡¨ã‚’ä½œã‚‹å¿…è¦ãŒã‚ã£ãŸãŸã‚ã§ã™ã€‚

- **å˜ç™ºã®å ´åˆ**

`/posts/example.md`ã¨ã—ãŸå ´åˆã€URLã¯`[host]/post/example`ã¨ãªã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

- **ã‚·ãƒªãƒ¼ã‚ºã®å ´åˆ**

`/posts/making-website/example.md`ã¨ã—ãŸå ´åˆã€URLã¯`[host]/post/making-website/example`ã¨ãªã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã“ã“ã§ã€ã‚·ãƒªãƒ¼ã‚ºã®è­˜åˆ¥å­ã¯`making-website`ã¨ãªã‚Šã¾ã™ã€‚

`/posts/making-website/meta.json`ãŒã‚ã‚‹å ´åˆã€ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®`name`ã€`description`ã«å¾“ã£ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```json:/posts/making-website/meta.json
{
  "name": "ãƒšãƒ¼ã‚¸ä½œã£ã¦ã¿ãŸ",
  "description": "Next.jsã¨GitHub APIã§ã‚µã‚¤ãƒˆæ§‹ç¯‰"
}
```

### ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã®è¨­è¨ˆ

ã‚³ãƒ¡ãƒ³ãƒˆã®ç®¡ç†ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªå†…ã® Issue ã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã—ãŸã€‚åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†å¯èƒ½ãªç‚¹ã¨ Issue è‡ªä½“ã®æ©Ÿèƒ½ã§ãƒ•ã‚©ãƒ¼ãƒ ã‚’åˆ¶å¾¡å¯èƒ½ãªãŸã‚ã§ã™ã€‚

ã‚³ãƒ¡ãƒ³ãƒˆã®æŠ•ç¨¿ã«ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒç„¡ãã¦ã‚‚å¯èƒ½ã«ã—ã¾ã—ãŸã€‚ãŸã ã—ã€

- IPã‚¢ãƒ‰ãƒ¬ã‚¹å˜ä½ã®æŠ•ç¨¿é–“éš”åˆ¶é™
- reCAPTCHAã«ã‚ˆã‚‹èªè¨¼

ã‚’è¨­ã‘ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚ä¸¡è€…ã¨ã‚‚ã«ã‚¹ãƒ‘ãƒ å¯¾ç­–ã‚’å…¼ã­ã¦ã„ã¾ã™ã€‚

ã—ã‹ã—ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã®æ©Ÿèƒ½ãŒä¸ååˆ†ãªãŸã‚ã€Issue ã®

- ãƒ­ãƒƒã‚¯æ©Ÿèƒ½ã§**ã‚³ãƒ¡ãƒ³ãƒˆã®æŠ•ç¨¿è¨±å¯ãƒ»ä¸è¨±å¯**
- ã‚ªãƒ¼ãƒ—ãƒ³/ã‚¯ãƒ­ãƒ¼ã‚ºã§**ã‚³ãƒ¡ãƒ³ãƒˆæ¬„è‡ªä½“ã®æœ‰åŠ¹ãƒ»ç„¡åŠ¹**

ã‚’è¨­å®šå¯èƒ½ã«ã—ã¾ã™ã€‚

### ãƒšãƒ¼ã‚¸ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€ 

ãƒ–ãƒ­ã‚°ã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã™ã‚‹ã®ã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚‚å°‘ã—è§¦ã‚Œã¾ã™ã€‚

![ãƒšãƒ¼ã‚¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ](/images/next-github-blog-launch/layout-over.webp)
*ãƒšãƒ¼ã‚¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ*

ç”»åƒã®ã‚ˆã†ã«`display: flex`ã¨`flex-direction`ã‚’çµ„ã¿åˆã‚ã›ã¾ã—ãŸã€‚`fixed`ã‚’ä½¿ã‚ãªã„ãŸã‚ã€ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’æ§‹ç¯‰ã—æ˜“ã„ã§ã™ã€‚

ä»¥ä¸‹ã‚ˆã‚Šå®Ÿè£…ã«å…¥ã‚Šã¾ã™ã€‚

## å®Ÿè£…ã«å…¥ã‚‹å‰ã«

ä»Šå›ã®å®Ÿè£…ã¯å¾Œã®`/src/static/constant.ts`ã¨`.env`ç³»çµ±ä»¥å¤–ã«è‡ªèº«ã‚’ç¤ºã™ã‚³ãƒ¼ãƒ‰ãŒå…¥ã‚‰ãªã„ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚
ã‚½ãƒ¼ã‚¹ã¯çœç•¥ã—ã¤ã¤æ²è¼‰ã™ã‚‹ãŸã‚ã€ã‚‚ã—ä¸æ˜ãªå ´åˆã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’åŸºã«å‚ç…§ã—ãŸã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚

CSS ã¯æ¨ªã‚µã‚¤ã‚ºæŒ‡å®šã¨ã‚¢ã‚¤ãƒ†ãƒ é…ç½®æ–¹æ³•ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç¤ºã—ã¾ã™ãŒã€ãã‚Œä»¥å¤–ã¯çœç•¥ã„ãŸã—ã¾ã™ã€‚

## å®Ÿè£…: ã‚µã‚¤ãƒˆã¨ã—ã¦

`$ pnpm create next-app`ã§ä½œæˆã—ã¾ã™ã€‚

```tree:ã‚µã‚¤ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
â”œâ”€â”€ public
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ comment-submission/
â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ post/
â”‚   â”‚   â”‚   â”œâ”€â”€ [slug]/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ feed/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ not-found.tsx
â”‚   â”‚   â”œâ”€â”€ sitemap.ts
â”‚   â”‚   â””â”€â”€ [...]
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ [...]
â”‚   â””â”€â”€ styles/
â”‚       â”œâ”€â”€ global.css
â”‚       â””â”€â”€ [...]
â”œâ”€â”€ .env
â””â”€â”€ [...]
```

### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®å®Ÿè£…

ã¾ãšã¯ã€`layout.tsx`ã‚’æ•´ãˆã¾ã™ã€‚

```tsx:/src/app/layout.tsx(ç°¡ç•¥)
export default function RootLayout({ children }) {
  return (
    <html lang="ja">
      <head />
      <body>
        <Header />
        <div className="md:flex justify-center">
          <Menu />
          {children}
        </div>
        <Footer />
      </body>
    </html>
  );
}
```

`<body>`ã‚¿ã‚°ã®ä¸­ã«ãƒ˜ãƒƒãƒ€ãƒ¼ã€ãƒ•ãƒƒã‚¿ãƒ¼ã€ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç½®ãã¾ã—ãŸã€‚ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯[ãƒšãƒ¼ã‚¸ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€ ](#ãƒšãƒ¼ã‚¸ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€ )ã®é€šã‚Š`flex`ã§é…ç½®ã—ã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§è¨­è¨ˆã—ã¾ã™ã€‚å·¦å´ã¯å…±é€šãƒ¡ãƒ‹ãƒ¥ãƒ¼ãªã®ã§åŒã˜å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ä¾‹ã¨ã—ã¦ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã®`page.tsx`ã‚’æ•´ãˆã¾ã™ã€‚

```tsx:/src/app/page.tsx
export default async function Blogs() {
  return <Main>
    <Side>
      {/* å³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */}
    </Side>
    <Section>
      <Title>ã‚¿ã‚¤ãƒˆãƒ«</Title>
      {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
    </Section>
  </Main>
}
```

`<Main>`ã€`<Side>`ã€`<Section>`ã€`<Title>`ã¯å…¨ã¦å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦å‘¼ã³å‡ºã—ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€å„ãƒšãƒ¼ã‚¸ã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå´©ã‚Œãªããªã‚Šã¾ã™ã€‚å®£è¨€ã¯`src`é…ä¸‹ã®`components`ã§è¡Œã„ã¾ã™ã€‚

```tsx:/src/components/layout/PageLayout.tsx(ç°¡ç•¥)
export function Main({ children }: { children?: React.ReactNode }) {
  return <main className="md:flex flex-row-reverse flex-grow md:flex-grow-0">
    {children}
  </main>
}

export function Side({ children }: { children?: React.ReactNode }) {
  return <div className="hidden md:block">
    <div className="w-full sticky">
      {children}
    </div>
  </div>
}

export function Section({ children }: { children?: React.ReactNode }) {
  return <section className="w-full mx-auto xl:m-0">
    {children}
  </section>
}

export function Title({ children }: { children: React.ReactNode }) {
  return <h1 className="text-3xl">
    {children}
  </h1>
}
```

`{ children: React.ReactNode }`ã«`undefined`ã‚’è¨±ã™ã‹ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®èª¿æ•´ãŒå¯èƒ½ã§ã™ã€‚

## GitHub API ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«

### ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œ

Personal access token(PAT) ã‚’ç™ºè¡Œã—ã¦ fetch ãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶å´ã¸ãƒ­ã‚°ã‚¤ãƒ³ã‚’è¦æ±‚ã—ãªã„ã®ã§ OAuth ã¯åˆ©ç”¨ã—ã¾ã›ã‚“ã€‚

[GitHub](https://github.com/) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€`ãƒ¡ãƒ‹ãƒ¥ãƒ¼`â†’`Settings`â†’`Developer settings`â†’`Personal access tokens`â†’`Tokens (classic)`ã‚’é¸æŠã—ã¦ Generate New Token ã§ repo æ¨©é™ã‚’ä¸ãˆã¦ç™ºè¡Œã—ã¾ã™ã€‚

### ç’°å¢ƒå¤‰æ•°ã¸ PAT ã‚’è¿½åŠ 

ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚

React è£½ App ã¯ãƒ«ãƒ¼ãƒˆç›´ä¸‹ã®`.env`ã«å€¤ã‚’æ›¸ãã¨ã‚½ãƒ¼ã‚¹å†…ã§å‘¼ã³å‡ºã›ã¾ã™ã€‚ä¾‹ãˆã°`.env.local`ã‚’è¿½åŠ ã™ã‚Œã° git ã«è¿½åŠ ã•ã‚Œãªã„éå…¬é–‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šå¯èƒ½ã§ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒªãƒã‚¸ãƒˆãƒªã§éå¸¸ã«é‡è¦ã§ã™ã€‚

```bash:.env.local
GIT_TOKEN=(YOUR TOKEN HERE)
```

ä»–ã«ã‚‚ãƒ¦ãƒ¼ã‚¶åã€ãƒªãƒã‚¸ãƒˆãƒªåã€æŠ•ç¨¿ãƒ•ã‚©ãƒ«ãƒ€åç­‰ã‚‚ç’°å¢ƒå¤‰æ•°ã§å®£è¨€ã—ã¾ã™ã€‚

```bash:.env.local(ä¾‹)
GIT_USERNAME=(YOUR USER NAME HERE)
GIT_REPO=(YOUR REPOSITORY NAME HERE)
GIT_POSTS_DIR=posts
GIT_IMAGES_DIR=img
GIT_PROFILE_PATH=profile/index.md
```

[è¨˜äº‹ã®ç®¡ç†æ–¹æ³•ã«ã¤ã„ã¦](#è¨˜äº‹ã®ç®¡ç†æ–¹æ³•ã«ã¤ã„ã¦)ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã«æƒãˆã¾ã—ãŸã€‚

ç’°å¢ƒå¤‰æ•°ã‚’ TypeScript ã§åˆ©ç”¨ã™ã‚‹ã¨ãã€

```ts
// string | undefined
const name = process.env.GIT_USERNAME
```

ã§ã¯ã€å‹ãŒ`string | undefined`ã«ãªã‚Šã¾ã™ã€‚ãã“ã§ã€æ¬¡ã®ã‚ˆã†ã«æ›¸ãã¨å‹ã‚’ä¸€æ„ã«è¨­å®šå¯èƒ½ã§ã™ã€‚

```ts
// string
const name = process.env.GIT_USERNAME!
```

:::message
ã‚‚ã—ã€`pnpm dev`ã¨`pnpm build && pnpm start`ã§å‚ç…§ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’å¤‰ãˆã‚‹å ´åˆã¯

```bash:.env.development.local
GIT_POSTS_DIR=dev_posts
```

```bash:.env.production.local
GIT_POSTS_DIR=posts
```

ã¨å®£è¨€ã‚’ã™ã‚‹ã“ã¨ã§æœ¬ç•ªç’°å¢ƒã«å½±éŸ¿ãªãé–‹ç™ºãŒå¯èƒ½ã§ã™ã€‚
:::

## å®Ÿè£…: è¨˜äº‹ã®å–å¾—ãƒ»è¡¨ç¤º

### API ã«ã‚ˆã‚‹å‘¼ã³å‡ºã—

API ã®URLã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```ts
const gitContentPath = `https://api.github.com/repos/${process.env.GIT_USERNAME!}/${process.env.GIT_REPO!}/contents`
```

`gitContentPath`ã‚’å®£è¨€ã—ã¾ã—ãŸã€‚æ¬¡ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ fetch æ™‚ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¼‰ã›ã‚‹ã¨ API ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹ã¨ãªã‚Šã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®å‚ç…§ãŒã§ãã¾ã™ã€‚

ä»Šå›è¤‡æ•°ã®æ–¹æ³•ã§`api.github.com`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ã§`init?`ç”¨ã«è¤‡æ•°ã®é–¢æ•°ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

- **ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±**

```ts:/src/lib/fetchingFunc.ts(æŠœç²‹)
export function getHeaders() {
  return {
    headers: {
      "Authorization": `token ${process.env.GIT_TOKEN!}`,
      "Content-Type": "application/json",
    }
  };
};
```

`Authorization`ã¯ãƒˆãƒ¼ã‚¯ãƒ³ã®æ–‡å­—åˆ—ã ã‘ã§ãªãã€`token "YOUR TOKEN HERE"`ã®å½¢ãŒå¿…è¦ã§ã™ã€‚

- **Next.js Cachingå¯¾ç­–**

Next.js ã§ã¯ç‰¹å®šã® URL ã¸ fetch ã—ãŸéš›ã€çµæœãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯æ°¸ç¶šçš„ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã€è§£æ¶ˆã™ã‚‹æ–¹æ³•ã¯ã€Œdevä¸­ã®`Ctrl + F5`ã‚„Vercelã®`Clear Caching Data`ã€ã¨æœ›ã¾ã—ããªã„çŠ¶æ³ã«ãªã‚Šã¾ã™ã€‚
ãã“ã§ã€`init?`ã«`next`ã‚’å«ã¾ã›ã‚‹ã“ã¨ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ™‚é–“ã®ç§’æŒ‡å®šãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚æœ¬è¨˜äº‹ã§ã¯ã“ã‚Œã‚’å¤šç”¨ã—ã¾ã™ã€‚

```ts:/src/lib/fetchingFunc.ts(æŠœç²‹)
export type FetchOptions = RequestInit & {
  next?: { revalidate: number };
};

export function getNext(revalidate: number): FetchOptions {
  if (revalidate === 0) {
    return { cache: 'no-store' };
  } else {
    return { next: { revalidate } };
  }
}
```

`getNext`é–¢æ•°ã§`revalidate: number`ã‚’å—ã‘å–ã‚Šã€0 ä»¥å¤–ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ™‚é–“ã‚’è¨­å®šã—ã¾ã™ã€‚0 ã®å ´åˆã¯æœ€æ–°ã®çŠ¶æ…‹ãŒå¿…è¦ã ã¨åˆ¤æ–­ã—ã€`cache: 'no-store'`ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚ãã®ãŸã‚ã€`FetchOptions`ã®å®šç¾©ãŒå¿…è¦ã«ãªã‚Šã¾ã—ãŸã€‚

### GitHub APIã®ãƒªã‚¹ãƒˆå–å¾—ã«ã¤ã„ã¦

è¨˜äº‹ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã—ã‚‡ã†ã€‚ã¾ãšã€å–å¾—ã ã‘ã‚’è€ƒãˆã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ä¸Š2ã¤ã®é–¢æ•°ã‚‚ä½¿ã†ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts
const data = await fetch(`${gitContentPath}/${process.env.GIT_POSTS_DIR!}`, {
    ...getHeaders(), ...getNext(3600)
  }).then(res => res.json()).catch(err => console.error(err));
```

`getNext(3600)`ã‚ˆã‚Šã€3600 ç§’ = 1 æ™‚é–“ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœŸé–“ã‚’è¨­ã‘ã¾ã—ãŸã€‚
`data`ã«ã¯é…åˆ—ã§ãƒ•ã‚¡ã‚¤ãƒ«åã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã€URLç­‰ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚

ã“ã“ã§ã€ã¨ã‚ã‚‹å•é¡ŒãŒç™ºç”Ÿã—ã¾ã™ã€‚**ãƒªã‚¹ãƒˆã¯30ä»¶ã¾ã§ã—ã‹å–å¾—ã§ããªã„**ç‚¹ã§ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã—ã¦ã‚‚æœ€å¤§100ä»¶ãªã®ã§ã€å…¨éƒ¨å–å¾—ã§ããªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä¿®æ­£æ–¹æ³•ã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ˜ãƒƒãƒ€å†…ã«ã‚ã‚‹`Link`ã‹ã‚‰å–å¾—ã—ã¾ã™ã€‚

ãã®ãŸã‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã—ãŸã€‚

```ts:/src/lib/fetchingFunc.ts(æŠœç²‹)
export async function fetchAllData(url: string, revalidate: number): Promise<any[]> {
  let results: any[] = [];
  let nextUrl: string | null = url;

  while (nextUrl) {
    const response: Response = await fetch(nextUrl, {
      ...getHeaders(), ...getNext(revalidate),
    });

    const data = await response.json();
    results = results.concat(data);

    const linkHeader = response.headers.get('Link');
    if (linkHeader) {
      const nextLinkMatch = linkHeader.match(/<([^>]+)>;\s*rel="next"/);
      nextUrl = nextLinkMatch ? nextLinkMatch[1] : null;
    } else {
      nextUrl = null;
    }
  }

  return results;
}
```

ãƒªã‚¹ãƒˆã‚’å¾—ã‚‹éš›ã¯æ¬¡ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

- `slug`: ãƒšãƒ¼ã‚¸ ID
- `excerpt`: è¨˜äº‹ã®æŠœç²‹(100æ–‡å­—ç¨‹åº¦)
- `data`: YAML ãƒ˜ãƒƒãƒ€(ã‚¿ã‚¤ãƒˆãƒ«ãƒ»æ—¥ä»˜ãƒ»ã‚¿ã‚°)

ãƒšãƒ¼ã‚¸IDã¯[ã‚µã‚¤ãƒˆä¸Šã®è¨˜äº‹ç®¡ç†](#ã‚µã‚¤ãƒˆä¸Šã®è¨˜äº‹ç®¡ç†)ã«å¾“ã„ã€`/posts/making-website/example.md`ãŒãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹å ´åˆã€`slug = "making-website/example"`ã¨ç®¡ç†ã—ã¾ã™ã€‚

```ts:/src/static/postType.ts
export type PostData = {
  title: string;
  tags?: string[];
  date?: string;
  series?: string;
  [key: string]: any;
};

export type Post = {
  slug: string;
  excerpt: string;
  data: PostData;
};
```

æœ¬å®Ÿè£…ã§ã¯ã€ã‚·ãƒªãƒ¼ã‚ºã‚’è¨­ã‘ã‚‹ã®ã§ãƒ•ã‚©ãƒ«ãƒ€ãŒæ··å…¥ã—ã¦ã„ã¾ã™ã€‚`data[i].type === 'dir'`ã®å ´åˆã€ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ fetch ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`dir?: string`ã‚’å¼•æ•°ã«ã‚·ãƒªãƒ¼ã‚ºã®ã¿ã®å–å¾—ã‚‚å¯¾å¿œã•ã›ã‚‹ãŸã‚ã€é–¢æ•°ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts:/src/lib/getPosts.ts(æŠœç²‹)
async function createPostFromFile(item: any, dir: string): Promise<Post | null> {
  const { data, excerpt } = await getPostContent(`${dir}/${item.name}`);
  if (data.title) {
    return {
      slug: item.path.replace(`${process.env.GIT_POSTS_DIR}/`, "").replace('.md', ''),
      data,
      excerpt,
    };
  }
  return null;
}

async function createPostsFromDirectory(item: any): Promise<Post[]> {
  const dirPath = `${process.env.GIT_POSTS_DIR}/${item.name}`;
  const dirContent = await fetchAllData(`${gitContentPath}/${dirPath}`, 3600);

  const markdownFiles = dirContent.filter((subItem) => subItem.type === "file" && subItem.name.endsWith('.md'));
  const dirFiles = await Promise.all(markdownFiles.map(subItem => createPostFromFile(subItem, dirPath)));

  return dirFiles.filter((post): post is Post => post !== null);
}

export const getPostsProps = cache(async (dir?: string): Promise<Post[]> => {
  const targetDir = dir ? `${process.env.GIT_POSTS_DIR}/${dir}` : process.env.GIT_POSTS_DIR!;
  const data = await fetchAllData(`${gitContentPath}/${targetDir}`, 3600);

  const posts: Post[] = [];

  for (const item of data) {
    if (item.type === "file" && item.name.endsWith('.md')) {
      const post = await createPostFromFile(item, targetDir);
      if (post) {
        posts.push(post);
      }
    } else if (!dir && item.type === "dir") {
      const dirPosts = await createPostsFromDirectory(item);
      posts.push(...dirPosts);
    }
  }

  return posts.sort(comparePosts);
});
```

`Post[]`é…åˆ—ã«è¿½åŠ ã™ã‚‹æ™‚ã«`data.title`ãŒç„¡ã„å ´åˆã¯å¼¾ãã¾ã™ã€‚ãƒ¬ãƒ³ãƒ€ãƒ¼ã§äº‹æ•…ãŒç™ºç”Ÿã—ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚

`getPostContent`é–¢æ•°ã‚‚è¨˜ã—ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥æŒ‡å®šã™ã‚‹ã¨`content`ã« base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ä¸­èº«ãŒã‚ã‚‹ã®ã§ãƒ‡ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¾ã™ã€‚

```ts:/src/lib/getPosts.ts(æŠœç²‹)
const getPostContent = cache(async (path: string): Promise<{ data: PostData; content: string; excerpt: string }> => {
  const fileJson = await fetch(`${gitContentPath}/${path}`, {
    ...getHeaders(), ...getNext(3600)
  }).then(res => res.json()).catch(err => console.error(err))

  if (fileJson?.message === 'Not Found' || fileJson?.status === 404) {
    notFound();
  }

  // ãƒ‡ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
  const buf = Buffer.from(fileJson.content, 'base64');
  const fileContent = buf.toString("utf-8");
  const { data, content } = matter(fileContent);

  // ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã‚ã‚‹å ´åˆã¯ã‚·ãƒªãƒ¼ã‚ºã«åå‰ã‚’è¿½åŠ 
  const pathParts = path.split('/');
  const outputData = pathParts.length > 2 ? { ...data, series: pathParts[1] } : data;

  // æŠœç²‹ã‚’ä½œæˆ
  const plainText = await MarkdownToPlainText(content);
  const excerpt = makeExcerpt(plainText, 128);

  return {
    data: outputData as PostData,
    content,
    excerpt,
  }
})
```

ã“ã“ã§ã€`notFound`é–¢æ•°ã‚’ç”¨æ„ã—ã¦ãŠãã¨äºˆæœŸã—ãªã„ãƒšãƒ¼ã‚¸ ID ã®å ´åˆã« 404 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

:::message

`notFound`é–¢æ•°ã¯/src/app/ã§å­˜åœ¨ã™ã‚‹å ´åˆã‚‚ã€`fetch`ã§ 404 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®éš›ã«åˆ©ç”¨ã™ã‚‹ã“ã¨ã§`/_not-found`ã¸è»¢é€ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```ts:notFound é–¢æ•°ã®åˆ©ç”¨
import { notFound } from 'next/navigation';
```

:::

### è¨˜äº‹ã®è¡¨ç¤º

å–å¾—ãŒã§ããŸã®ã§è¡¨ç¤ºã—ã¾ã™ã€‚

- **è¨˜äº‹ä¸€è¦§ã®è¡¨ç¤º**

`/src/app/post/page.tsx`ã«ã¦æŠ•ç¨¿ä¸€è¦§ã‚’ä½œæˆã—ã¾ã™ã€‚
[ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®å®Ÿè£…](#ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®å®Ÿè£…)ã§ä½œã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦çµ±ä¸€ã—ãŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚‚ä½œæˆã—ã¾ã™ã€‚

```tsx:/src/app/post/page.tsx(ç°¡ç•¥)
export default async function PostList() {
  const posts = await getPostsProps();

  return <Main>
    <Side />
    <Section>
      <Title>æŠ•ç¨¿ä¸€è¦§</Title>
      <div className='flex flex-col'>
        {posts.map((post, i) => <PostCard post={post} key={i} />)}
      </div>
    </Section>
  </Main>
}
```

![/post ã®è¡¨ç¤º](/images/next-github-blog-launch/posts-over.png)
*/post ã®è¡¨ç¤º*

ãƒ¡ã‚¤ãƒ³ã®è¨˜è¿°ãŒã‚¹ãƒƒã‚­ãƒªæ›¸ã‘ã¾ã—ãŸã€‚`<PostCard />`ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ä»–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚‚å†åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```tsx:/src/components/post/PostCard.tsx(ç°¡ç•¥)
export default function PostCard({ post }: { post: Post }) {
  return <div>
    <div><Link href={`/post/${post.slug}`}>
      <div className="flex items-center">
        <DateCard date={post.data.date} />
        <div>
          <p>
            {post.data.series ? <span>ã‚·ãƒªãƒ¼ã‚º</span> : <></>}
            <span>{post.data.title}</span>
          </p>
          <p>{makeExcerpt(post.excerpt, 64)}</p>
        </div>
      </div></Link>
    </div>
    {post.data.tags || post.data.series ?
      <div className='flex flex-wrap'>
        {post.data.series ? <Link href={`/series/${post.data.series}`}>
          <div>
            <span>ã‚·ãƒªãƒ¼ã‚ºã‚’è¡¨ç¤º</span>
          </div>
        </Link> : <></>}
        {post.data.tags?.map((tag, i) => <TagBanner tag={tag} key={i} />)}
      </div> : <></>}
  </div>
}
```

- **è¨˜äº‹ã®è¡¨ç¤º**

ãƒ–ãƒ­ã‚°ã¨ã—ã¦è¨˜äº‹ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚`/src/app/post/[...slug]/page.tsx`ã«ã¦æŠ•ç¨¿ä¸€è¦§ã‚’ä½œæˆã—ã¾ã™ã€‚
`[ ]`ãŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã«ã‚ã‚‹ãŸã‚ Dynamic Routes ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã‚‹é€šã‚Šã€`[ ]`ã®æ›¸ãæ–¹æ¬¡ç¬¬ã§ TypeScript ã«ãŠã‘ã‚‹å‹ãŒç•°ãªã‚Šã¾ã™ã€‚`slug`ã§æ—¢ã«`/`ãŒå…¥ã‚‹ãŸã‚å¤šé‡æ§‹é€ ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã‚ã‚Šã€æŒ‡å®šæ–¹æ³•ã¯`[...slug]`ã¨ãªã‚Šã¾ã™ã€‚

`[[...slug]]`ã¯`slug?: string[]`ã¨`undefined`ã‚‚å¯¾è±¡ã¨ãªã‚Šã¾ã™ã€‚ã“ã®å ´åˆã€è¨˜äº‹ä¸€è¦§ã®ãƒšãƒ¼ã‚¸ã‚‚æ‹¾ã‚ã‚Œã‚‹ã®ã§åˆ©ç”¨ã—ã¾ã›ã‚“ã€‚

@[card](https://nextjs.org/docs/app/building-your-application/routing/dynamic-routes#typescript)

```tsx:/src/app/post/[...slug]/page.tsx(ç°¡ç•¥)
const getFileContent = cache(async (path: string) => {
  const decodedSlug = decodeURIComponent(path);
  const postPath = `${process.env.GIT_POSTS_DIR!}/${decodedSlug}.md`
  return await getPost(postPath);
})

export default async function Post({ params }: { params: { slug: string[] } }) {
  const slug = params.slug.join('/')
  const { data, content } = await getFileContent(slug);
  const issue = await getCommentList(slug);

  return <Main>
    <SideMDShown>
      <PostIndex content={content} title={data.title} />
      <div>
        <div>å…±æœ‰</div>
        <ShareButtons path={`/post/${slug}`} text={data.title} />
      </div>
    </SideMDShown>
    <Article data={data} content={content} issue={issue} slug={slug} />
  </Main>
}
```

`getFileContent`é–¢æ•°ã¯ Metadata ã®ä½œæˆæ™‚ã«å†åˆ©ç”¨ã—ã¾ã™ã€‚è¨˜äº‹ã®æœ¬ç·¨ã¯`<Article />`ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã—ã¾ã—ãŸã€‚`page.tsx`ã‚’ã‚¹ãƒƒã‚­ãƒªã•ã›ã‚‹ç›®çš„ã¨`/profile`ã§åŒã˜ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å‡ºåŠ›ã—ãŸã„ãŸã‚ã§ã™ã€‚

```tsx:/src/components/layout/ArticlePage.tsx
export default async function Article({ data, content, issue, slug }: { data: PostData, content: string, issue?: Issue, slug?: string }) {
  const series = data.series ? await getSeries(data.series) : undefined;

  return <article className="w-full">
    <div className="flex items-center">
      <DateCard date={data.date} />
      <h1>{data.title}</h1>
    </div>
    {data.tags ?
      <div className="flex flex-wrap">
        {data.tags?.map((tag, i) =>
          <TagBanner tag={tag} key={i} />)}
      </div> :
      <></>}
    {series ?
      <div>
        <SeriesCard
          slug={data.series}
          index={series.posts.findIndex((item) => item.slug === slug)}
        />
      </div> : <></>}
    <PostMarkdown content={content} />
    {/* ã“ã“ã«ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ */}
  </article>
}
```

![/post/[...slug]ã®è¡¨ç¤º](/images/next-github-blog-launch/posts-slug-over.png)
*/post/[...slug]ã®è¡¨ç¤º*

`getPost`é–¢æ•°ã§è¿”ã•ã‚Œã‚‹`data.series`ã‚’å¼•æ•°ã«ã—ã¦`getSeries`é–¢æ•°ã§ã‚·ãƒªãƒ¼ã‚ºã‚’å–å¾—ã—ã¾ã—ãŸã€‚

ã“ã®ã‚ˆã†ã«`<PostCard />`ã‚„`<Article />`ã®ã‚ˆã†ã«`data.*`ã§å‚ç…§ã™ã‚‹ã“ã¨ãŒç¢ºå®šã—ã¦ã„ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå¤šã„ãŸã‚[GitHub APIã®ãƒªã‚¹ãƒˆå–å¾—ã«ã¤ã„ã¦](#github-apiã®ãƒªã‚¹ãƒˆå–å¾—ã«ã¤ã„ã¦)ã®`/src/static/postType.ts`ã§ã¯ä¸€éƒ¨å¤‰æ•°ã§å‹ã‚’å®£è¨€ã—ã€`[key: string]: any`ã§æœªå®šç¾©ã«ã‚‚å¯¾å¿œã•ã›ã¾ã—ãŸã€‚

`issue`ã¯æ¬¡ç« ã§åˆ©ç”¨ã—ã¾ã™ã€‚

### è¨˜äº‹å†…ã®ç”»åƒè¡¨ç¤º

`<PostMarkdown content={content} />`ã§ MD å½¢å¼ã§æ›¸ã‹ã‚ŒãŸæ–‡å­—åˆ—ã‚’å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚`<ReactMarkdown />`ã‚’ä»Šå›ã¯ä½¿ã„ã¾ã™ã€‚

@[card](https://www.npmjs.com/package/react-markdown)

```tsx
<ReactMarkdown
  disallowedElements={["h1"]}
  components={components}
  remarkPlugins={[remarkMath, remarkGfm]}
  rehypePlugins={[rehypeRaw]}>
  {content}
</ReactMarkdown>
```

`h1`ã ã‘ã¯è¡¨ç¤ºã®éƒ½åˆä¸Šå›°ã‚‹ã®ã§å¼¾ãã¾ã™ã€‚`components`ã¯HTMLã‚¿ã‚°ã§ä»»æ„ã®ã‚‚ã®ã«å¤‰æ›ã•ã‚ŒãŸå ´åˆã€è¨­å®šã—ãŸé–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

```tsx:/src/components/post/MarkdownElements.tsx
function getMimeType(path: string) {
  const ext = path.split('.').pop()?.toLowerCase();
  switch (ext) {
    case 'jpg':
    case 'jpeg':
      return 'image/jpeg';
    case 'png':
      return 'image/png';
    case 'gif':
      return 'image/gif';
    case 'webp':
      return 'image/webp';
    case 'bmp':
      return 'image/bmp';
    default:
      return 'application/octet-stream';
  }
}

async function ExImg({ path, alt }: { path: string, alt?: string }) {
  const image64 = await getImage(path);
  const mimeType = getMimeType(path);
  return <img alt={alt} src={`data:${mimeType};base64,${image64}`} />
}

// h2, h3ã¯çœç•¥

const Img = ({ node, ...props }:
  ClassAttributes<HTMLImageElement> &
  HTMLAttributes<HTMLImageElement> &
  ExtraProps & { src?: string, alt?: string }) => {
  const src = props.src as string || '';
  const alt = props.alt as string || '';
  if (src.startsWith(`/${process.env.GIT_IMAGES_DIR!}/`)) {
    return <ExImg path={src} alt={alt} />
  } else
    return (
      <img {...props}>{props.children}</img>
    );
};

const Pre = ({ children, ...props }:
  ClassAttributes<HTMLPreElement> &
  HTMLAttributes<HTMLPreElement> &
  ExtraProps) => {
  if (!children || typeof children !== 'object') {
    return <code {...props}>{children}</code>
  }
  const childType = 'type' in children ? children.type : ''
  if (childType !== 'code') {
    return <code {...props}>{children}</code>
  }

  const childProps = 'props' in children ? children.props : {}
  const { className, children: code } = childProps
  const classList = className ? className.split(':') : []
  const language = classList[0]?.replace('language-', '')
  const fileName = classList[1]

  return (
    <div className="post_codeblock w-full">
      {fileName && (
        <div className="post_fname">
          <span>{fileName}</span>
        </div>
      )}
      <SyntaxHighlighter language={language} style={atomOneDark}>
        {String(code).replace(/\n$/, '')}
      </SyntaxHighlighter>
      <CopyToClipboard text={String(code).replace(/\n$/, '')} />
    </div>
  )
}

const A = ({ href, ...props }:
  ClassAttributes<HTMLAnchorElement> &
  HTMLAttributes<HTMLAnchorElement> &
  { href?: string }) => {
  const isInternalLink = href?.startsWith("/");
  return isInternalLink ? (
    <a href={href} {...props}>{props.children}</a>
  ) : (
    <a href={href} target="_blank" rel="noopener noreferrer" {...props}>{props.children}</a>
  );
};

export const components: Partial<Components> = {
  pre: Pre, h2: H2, h3: H3, img: Img, a: A
}
```

`components`ã«ã¦ JSON å½¢å¼ã§å¯¾å¿œé–¢ä¿‚ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚

`<a>`ã‚¿ã‚°ã¯`/`ã‹ã‚‰å§‹ã¾ã‚‹å ´åˆã¯å†…éƒ¨ãƒªãƒ³ã‚¯ã¨åˆ¤å®šã—ãã®ã¾ã¾è»¢é€ã€ãã‚Œä»¥å¤–ã®å ´åˆã¯æ–°è¦ã‚¿ãƒ–ã§é–‹ããŸã‚ã«`target="_blank" rel="noopener noreferrer"`ã‚’æŒŸã¿ã¾ã—ãŸã€‚

`<img>`ã‚¿ã‚°ã¯`/posts(ä»»æ„ã®åå‰)/`ã‹ã‚‰å§‹ã‚‰ãªã„ãƒ‘ã‚¹ã®å ´åˆã€ãã®ã¾ã¾ã®å½¢ã§å‡ºåŠ›ã—ã¾ã™ã€‚ãã‚Œä»¥å¤–ã®å ´åˆã€GitHub ã‹ã‚‰å¾—ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨åˆ¤æ–­ã—ãŸãŸã‚ã€fetch ã‚’è¡Œã„ã¾ã™ã€‚ã—ã‹ã—ç”»åƒãŒ 1MB ã‚’è¶…ãˆãŸéš›ã¯è¨˜äº‹ã¨åŒã˜æ–¹æ³•ã§å–å¾—ãŒã§ããªã„ãŸã‚ã€åŒæ™‚ã«å¾—ã‚‰ã‚Œã‚‹`git_url`ã§ã‚‚ã†ä¸€åº¦ fetch ã—ã¾ã™ã€‚base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§å¾—ã‚‰ã‚Œã€è­˜åˆ¥ç”¨ã®ã‚¿ã‚°ã‚’å…±ã« src ã¸æŒ¿å…¥ã™ã‚‹ã“ã¨ã§è¡¨ç¤ºãŒå¯èƒ½ã§ã™ã€‚`ExImg`é–¢æ•°ã«ã¦è¤‡æ•°ã®ç”»åƒæ‹¡å¼µå­ã«å¯¾å¿œã—ã¦ãŠãã¾ã—ãŸã€‚`getImage`é–¢æ•°ã‚’ç¤ºã—ã¾ã™ã€‚

```ts:/src/lib/getPosts.ts(æŠœç²‹)
export const getImage = cache(async (path: string) => {
  const fileJson = await fetch(`${gitContentPath}${path}`, {
    ...getHeaders(), ...getNext(3600 * 24 * 30)
  }).then(res => res.json()).catch(err => console.error(err));

  // ã‚‚ã†ä¸€åº¦git_urlã§å–å¾—
  const imageJson = await fetch(fileJson.git_url, {
    ...getHeaders(), ...getNext(3600 * 24)
  }).then(res => res.json()).catch(err => console.error(err));
  return imageJson.content as string;
})
```

## å®Ÿè£…: ã‚³ãƒ¡ãƒ³ãƒˆãƒ•ã‚©ãƒ¼ãƒ 

![ã‚³ãƒ¡ãƒ³ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®å…¨ä½“åƒ](/images/next-github-blog-launch/posts-comments.png)
*ã‚³ãƒ¡ãƒ³ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®å…¨ä½“åƒ*

### ã‚³ãƒ¡ãƒ³ãƒˆã®å–å¾—

MD ãƒ•ã‚¡ã‚¤ãƒ«ç½®ã‹ã‚Œã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã® Issue ã‚’ä½¿ã£ã¦ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã‚’ä½œã‚Šã¾ã™ã€‚[è¨˜äº‹ã¨åŒã˜è¦é ˜](#github-apiã®ãƒªã‚¹ãƒˆå–å¾—ã«ã¤ã„ã¦)ã§å–å¾—ã—ã¾ã™ã€‚

Issue ã¨ ã‚³ãƒ¡ãƒ³ãƒˆã§å¿…è¦ãªå‹ã‚’æ±ºã‚ã¾ã™ã€‚

1. **Comment**: ã‚³ãƒ¡ãƒ³ãƒˆ

- **date**: æŠ•ç¨¿ã•ã‚ŒãŸæ—¥ä»˜
- **content**: å†…å®¹(MD å½¢å¼)

2. **Issue**: Issue

- **comments**: ã‚³ãƒ¡ãƒ³ãƒˆé…åˆ—
- **locked**: Issue ãŒãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‹
- **state**: Issue ãŒ`Open`ã‹`Closed`ã‹

```ts:/src/static/issueType.ts
export type Comment = {
  date: string,
  content: string
}

export type Issue = {
  comments: Comment[],
  locked: boolean,
  state: "open" | "closed"
}
```

`getCommentList`é–¢æ•°ã‚’ä½œã‚Šã¾ã™ã€‚Issue ã®æ¢ã—æ–¹ã¯ã‚¿ã‚¤ãƒˆãƒ«åã®å®Œå…¨ä¸€è‡´ã§ã™ã€‚ã‚¿ã‚¤ãƒˆãƒ«ã‚’`slug`ã¨ã™ã‚‹ã®ã§ã€ã‚·ãƒ³ãƒ—ãƒ«ãªæ¤œç´¢ãŒå¯èƒ½ã§ã™ã€‚

```ts:/src/lib/commentIssueManager.ts(æŠœç²‹)
export const getCommentList = cache(async (slug: string): Promise<Issue> => {
  const targetIssue = await getIssue(slug);

  if (targetIssue) {
    const data = await fetch(targetIssue.commentsURL, {
      ...getHeaders(), ...getNext(20),
    })
      .then((res) => res.json())
      .catch((e) => console.error(e));

    const comments: Comment[] = [];
    for (const item of data) {
      const date = new Date(item.created_at as string);
      comments.push({
        date: date.toLocaleString("ja-JP"),
        content: item.body as string,
      });
    }
    return {
      comments,
      locked: targetIssue.locked,
      state: targetIssue.state
    };
  } else {
    createIssue(slug);
    return {
      comments: [],
      locked: false,
      state: "open"
    }
  }
});
```

- **getIssue** é–¢æ•°

`fetchAllData`é–¢æ•°ã¨ã‚¿ã‚¤ãƒˆãƒ«åæ¤œç´¢(`${gitIssuePath}?q=${encodeURIComponent(slug)}+in:title&state=all`)ã‚’çµ„ã¿åˆã‚ã›ã¾ã™ã€‚

```ts:/src/lib/commentIssueManager.ts(æŠœç²‹)
const gitIssuePath = `https://api.github.com/repos/${process.env.GIT_USERNAME!}/${process.env.GIT_REPO!}/issues`;

const getFilteredIssuePath = (slug: string) =>
  `${gitIssuePath}?q=${encodeURIComponent(slug)}+in:title&state=all`;

async function getIssue(slug: string, revalidate: number = 120) {
  const data = await fetchAllData(getFilteredIssuePath(slug), revalidate);

  if (data && data.length > 0) {
    const issue = data.find((item: any) => item.title === slug);
    if (issue) {
      return {
        slug: issue.title as string,
        commentsURL: issue.comments_url as string,
        locked: issue.locked as boolean,
        state: issue.state as "open" | "closed"
      };
    }
  }
  return null;
}
```

- **createIssue** é–¢æ•°

`issueCreationMap`ã¨ã„ã†ãƒãƒƒãƒ—å¤‰æ•°ã‚’ä½œæˆã—ã¾ã—ãŸã€‚ã‚­ãƒ¼ã‚’`string`ã«ã—ã€å€¤ã‚’`Promise<void>`ã«ã™ã‚‹ã¨ã€é–¢æ•°ã®è¨˜è¿°ã‚’ä»£å…¥ã¨åŒæ™‚ã«è¡Œãˆã¾ã™ã€‚çµ‚äº†å¾Œã«ã‚­ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã§ã€Issue ãŒå‰Šé™¤ã•ã‚ŒãŸå¾Œã«å†åº¦ä½œæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã“ã®æ‰‹æ³•ã®ç†ç”±ã¯ã€`getIssue`ã§ null ã ã£ãŸå ´åˆã«`createIssue`ãŒå‘¼ã°ã‚Œã¾ã™ãŒã‚¢ã‚¯ã‚»ã‚¹ç­‰ã®å•é¡Œã§åŒæ™‚å®Ÿè¡Œã•ã‚Œã€åŒå Issue ãŒç™ºç”Ÿã™ã‚‹ãŸã‚ã§ã™ã€‚ãã®ãŸã‚ã€ã‚­ãƒ¼å€¤ã®æœ‰ç„¡ã§åŒæ™‚å®Ÿè¡ŒãŒç™ºç”Ÿã—ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚

```ts
const issueCreationMap: Record<string, Promise<void> | undefined> = {};

const createIssue = cache(async (slug: string) => {
  if (!issueCreationMap[slug]) {
    issueCreationMap[slug] = (async () => {
      const targetIssue = await getIssue(slug, 0);
      if (targetIssue) return;
      const data = {
        title: slug,
        body: `${process.env.NEXT_PUBLIC_URL!}/post/${slug}`,
        labels: ["user-comment"],
      };

      await fetch(gitIssuePath, {
        method: "POST",
        body: JSON.stringify(data),
        ...getHeaders(),
      })
        .then((res) => {
          if (res.status !== 201) {
            console.error(`Error creating issue: ${res.status} - ${res.statusText}`);
          } else {
            console.log(`Issue created successfully for slug: ${slug}`);
          }
        })
        .catch((e) => console.error(e));
    })();

    issueCreationMap[slug].finally(() => {
      delete issueCreationMap[slug];
    });

    return issueCreationMap[slug];
  } else {
    return issueCreationMap[slug];
  }
});
```

### reCAPTCHA ã®å°å…¥

ã‚³ãƒ¡ãƒ³ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºã™ã‚‹å‰ã« reCAPTCHA ã‚’å°å…¥ã—ã¾ã™ã€‚

@[card](https://www.google.com/recaptcha/about/)

ã“ã“ã§ã¯ã€ã‚µã‚¤ãƒˆã‚­ãƒ¼ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã®ç™ºè¡Œæ‰‹é †ã¯å‰²æ„›ã—ã¾ã™ã€‚

```bash:å°å…¥æ–¹æ³•
pnpm add react-google-recaptcha-v3
```

ã“ã“ã§ã€`.env.local`ã«ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```bash:.env.local(æŠœç²‹)
NEXT_PUBLIC_RECAPTCHA_SITE_KEY=(YOUR KEY HERE)
RECAPTCHA_SECRET_KEY=(YOUR KEY HERE)
```

### ã‚³ãƒ¡ãƒ³ãƒˆã®è¡¨ç¤º

- **ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ã®è¡¨ç¤ºã¨reCAPTCHAã®é…ç½®**

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«`<GoogleReCaptchaProvider />`ã‚’é…ç½®ã—ã¾ã™ã€‚

```tsx:/src/components/post/CommentForm.tsx(ç°¡ç•¥)
"use client";
import { GoogleReCaptchaProvider } from "react-google-recaptcha-v3";

function CommentsView({ comments }: { comments: Comment[] }) {
  return <div className="flex flex-col">
    {comments.length > 0 ? comments.map((comment, i) => (
      <div key={i} className="block items-start lg:flex">
        <DateCard date={comment.date} />
        <div className="flex-grow min-w-0">
          <CommentMarkdown content={comment.content} />
        </div>
      </div>
    )) :
      <ExplainingBanner>
        ã‚³ãƒ¡ãƒ³ãƒˆã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“
      </ExplainingBanner>}
  </div>
}

export function CommentForm({ comments, slug }: { comments: Comment[], slug: string }) {
  return <GoogleReCaptchaProvider
    reCaptchaKey={process.env.NEXT_PUBLIC_RECAPTCHA_SITE_KEY!}
    language="ja">
    <section>
      <h2>ã‚³ãƒ¡ãƒ³ãƒˆ</h2>
      <CommentsView comments={comments} />
      <PostingForm slug={slug} />
    </section>
  </GoogleReCaptchaProvider>
}
```

`NEXT_PUBLIC_RECAPTCHA_SITE_KEY`ã®ã‚ˆã†ã«ã€`NEXT_PUBLIC_`ã‹ã‚‰å§‹ã¾ã‚‹ç’°å¢ƒå¤‰æ•°ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–ã•ã‚Œã¾ã™ã€‚ã‚‚ã—ç„¡ã„å ´åˆã¯ undefined ã¨ãªã‚Šã€reCAPTCHA ãŒèµ·å‹•ã›ãšå³ä¸‹ã«ãƒãƒŠãƒ¼ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚

- **ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆ**

ã“ã¡ã‚‰ã‚‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ä½œæˆã—ã¾ã™ã€‚å…ˆã«å…¨éƒ¨è¼‰ã›ãŸå¾Œã€èª¬æ˜ã—ã¾ã™ã€‚

```tsx:/src/components/post/CommentPostingBox.tsx(ç°¡ç•¥)
'use client';
import { useGoogleReCaptcha } from "react-google-recaptcha-v3";

export default function PostingForm({ slug }: { slug: string }) {
  const [inputtedValue, setInputtedValue] = useState<string>("");
  const [isInputting, setIsInputting] = useState<boolean>(true);
  const [isSubmitting, setIsSubmitting] = useState<boolean>(false);
  const [notificationBanner, setNotificationBanner] = useState<React.ReactNode>()
  const { executeRecaptcha } = useGoogleReCaptcha();

  const handleSubmit = async () => {
    setNotificationBanner(null);
    if (inputtedValue.trim() === "") {
      setNotificationBanner(GenerateNotificationBanner("ã‚³ãƒ¡ãƒ³ãƒˆã®å…¥åŠ›ãŒå¿…é ˆã§ã™", false));
      return;
    }
    if (!executeRecaptcha) {
      setNotificationBanner(GenerateNotificationBanner("ReCaptcha ã‚’å®Ÿè¡Œã§ãã¾ã›ã‚“ã§ã—ãŸ", false));
      return;
    }
    const token = await executeRecaptcha('submitComment');
    setIsSubmitting(true);

    try {
      const response = await fetch('/api/comment-submission', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ slug, comment: inputtedValue, token }),
      });
      if (response.ok) {
        setNotificationBanner(GenerateNotificationBanner("ã‚³ãƒ¡ãƒ³ãƒˆãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸ", true));
        setInputtedValue("");
      } else {
        const data = await response.json();
        setNotificationBanner(GenerateNotificationBanner(`ã‚³ãƒ¡ãƒ³ãƒˆã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: ${data.error}`, false));
      }
    } catch (e) {
      setNotificationBanner(GenerateNotificationBanner(`ã‚³ãƒ¡ãƒ³ãƒˆã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: ${e}`, false));
    } finally {
      setIsSubmitting(false);
    }
  }

  return (
    <div>
      <div className="flex">
        <button onClick={() => setIsInputting(true)}>ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›</button>
        <button onClick={() => setIsInputting(false)}>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
      </div>
      {isInputting ?
        <textarea
          onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => setInputtedValue(e.target.value)}
          value={inputtedValue}
          placeholder="Markdownå½¢å¼ã§å…¥åŠ›å¯" /> :
        <div>
          {inputtedValue.trim() !== "" ? <CommentMarkdown content={inputtedValue} /> :
            <ExplainingBanner>
              ã€Œã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ã€ã§å…¥åŠ›å¾Œã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãŠè©¦ã—ãã ã•ã„
            </ExplainingBanner>}
        </div>
      }
      <div className="items-center flex flex-row-reverse">
        <button onClick={handleSubmit} disabled={isSubmitting}>
          {isSubmitting ? "é€ä¿¡ä¸­..." : "é€ä¿¡"}
        </button>
        <div className="flex-1">
          This site is protected by reCAPTCHA and the Google <a href="https://policies.google.com/privacy">Privacy Policy</a> and <a href="https://policies.google.com/terms">Terms of Service</a> apply.
        </div>
      </div>
      {notificationBanner ? notificationBanner : <></>}
    </div>
  )
}
```

ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã‚‚å®Ÿè£…ã—ã¾ã—ãŸã€‚`setInputtedValue`é–¢æ•°ãŒ`<textarea>`ã® onChange ã§å‹•ä½œã—ã€inputtedValue ãŒå¤‰åŒ–ã—ã¾ã™ã€‚`inputtedValue.trim() !== ""`ã®æ™‚ã®ã¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã™ã‚‹ã®ã§ç©ºç™½ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚

é€ä¿¡ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨`handleSubmit`é–¢æ•°ãŒå‹•ä½œã—ã¾ã™ã€‚
äºˆã‚ã€ç©ºæ–‡å­—ã®å ´åˆã¯å¼¾ãã¾ã™ã€‚ãã—ã¦`executeRecaptcha`ãŒå®Ÿä½“ã‚’æŒã¤ã‹ç¢ºèªã—ãŸã®ã¡é–¢æ•°ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚å¼•æ•°ã®æ–‡å­—åˆ—ã¯ã€æã‚‰ãã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦åŒºåˆ¥ãŒå¯èƒ½ãªã‚‰å•é¡Œãªã„ã¨æ€ã„ã¾ã™ã€‚

API Routeã«ã‚ã‚‹`/api/comment-submission`ã¸ POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ãƒªãƒ³ã‚¯å…ˆã§ GitHub API ã‚’åˆ©ç”¨ã—ã¦ Issue ã¸ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ã’ã¾ã™ã€‚body ã«ã¯ã€è¨˜äº‹ã®IDã€ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ã€`executeRecaptcha`é–¢æ•°ã§å¾—ã‚‰ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’å«ã‚ã¾ã™ã€‚

ãã—ã¦`response.ok`ã‚’å¾—ã‚‰ã‚ŒãŸå ´åˆã€æˆåŠŸã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’çµ‚ãˆãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ inputtedValue ã‚’ç©ºã«ã—ã¾ã™ã€‚

API ã«èªè¨¼ãƒ»é€ä¿¡å‡¦ç†ã‚’ä»»ã›ã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¨˜è¿°é‡ã¯å°‘ãªã‚ã§ã™ã€‚

:::message alert

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆèª­ã¿è¾¼ã¿æ™‚ã«`executeRecaptcha`ã‚’å–å¾—ã—ã¾ã™ãŒã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ`<GoogleReCaptchaProvider />`å†…ã§å‘¼ã°ã‚Œã‚‹ã“ã¨ãŒå‰æã§ã™ã€‚æº€ãŸã•ãªã„å ´åˆã€

```ts
const token = await executeRecaptcha('submitComment');
```

ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã¾ã™ã€‚

```tsx:å‹•ä½œã™ã‚‹å ´åˆã®ã‚¤ãƒ¡ãƒ¼ã‚¸
return <GoogleReCaptchaProvider>
  {/* executeRecaptchaã‚’å–å¾—ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ */}
  <ComponentUsingExecuteRecaptcha />
</GoogleReCaptchaProvider>
```

:::

### èªè¨¼ä»˜ãã‚³ãƒ¡ãƒ³ãƒˆé€ä¿¡ API ã®ä½œæˆ

`/src/app/api/comment-submission/route.ts`ã‚’ä½œæˆã—ã¾ã™ã€‚App Routerã«ãªã‚Šã€é–¢æ•°åã‚’ method ã§æ›¸ã‹ãªã„ã¨ã„ã‘ãªããªã‚Šã¾ã—ãŸã€‚

```ts:/src/app/api/comment-submission/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { LRUCache } from 'lru-cache';

const rateLimit = new LRUCache<string, number>({
  max: 1000,
  ttl: 1000 * 60 * 60,
});

const getHeaders = () => {
  return {
    "Authorization": `token ${process.env.GIT_TOKEN!}`,
    "Content-Type": "application/json",
  };
};

const authorize = async (token: string) => {
  const secretKey = `secret=${process.env.RECAPTCHA_SECRET_KEY!}&response=${token}`;
  const data = await fetch("https://www.google.com/recaptcha/api/siteverify", {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded",
    },
    body: secretKey,
  }).then(res => res.json());

  return data;
}

export async function POST(req: NextRequest) {
  const { slug, comment, token } = await req.json();
  const ip = req.ip || req.headers.get('x-forwarded-for') || 'unknown';

  if (!slug || !comment || !token) {
    return NextResponse.json({ error: 'Missing slug or comment body' }, { status: 400 });
  }

  const requestCount = rateLimit.get(ip) || 0;
  if (requestCount > 10) {
    return NextResponse.json({ error: 'Too many requests' }, { status: 429 });
  }
  rateLimit.set(ip, requestCount + 1);

  const recaptchaJson = await authorize(token);

  if (!recaptchaJson.success) {
    return NextResponse.json({ error: "ReCAPTCHA verification failed" }, { status: 401 })
  }

  try {
    const issueResponse = await fetch(`https://api.github.com/repos/${process.env.GIT_USERNAME!}/${process.env.GIT_REPO!}/issues`, {
      headers: getHeaders(),
    });
    const issues = await issueResponse.json();
    const issue = issues.find((issue: any) => issue.title === slug);

    if (!issue) {
      return NextResponse.json({ error: `Issue with slug "${slug}" not found` }, { status: 404 });
    }

    // ã‚³ãƒ¡ãƒ³ãƒˆã®è¿½åŠ 
    const commentsURL = issue.comments_url;
    const data = {
      body: comment,
    };

    const response = await fetch(commentsURL, {
      method: 'POST',
      headers: getHeaders(),
      body: JSON.stringify(data),
    });

    if (response.ok) {
      return NextResponse.json({ message: 'Comment added successfully' }, { status: 200 });
    } else {
      const errorText = await response.text();
      return NextResponse.json({ error: `Failed to add comment: ${errorText}` }, { status: response.status });
    }

  } catch (e) {
    console.error('Error adding comment:', e);
    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
  }
}
```

`req.json()`ã§ body ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å¾—ã¾ã™ã€‚

```ts
const { slug, comment, token } = await req.json();
```

[ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã®è¨­è¨ˆ](#ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã®è¨­è¨ˆ)ã«ã‚ã‚‹é€šã‚Šã€IP ã‚¢ãƒ‰ãƒ¬ã‚¹å˜ä½ã®æŠ•ç¨¿é–“éš”åˆ¶é™ã‚’è¨­ã‘ã‚‹ã®ã§ã€`req`ã‚ˆã‚Šå–å¾—ã—ã¾ã™ã€‚
ã¾ãŸã€ã“ã®æ™‚ç‚¹ã§ body ã«æ›¸ã‹ã‚Œã‚‹ã¹ããƒ‡ãƒ¼ã‚¿ãŒè¶³ã‚Šãªã„å ´åˆã¯ 400 ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã—ã¾ã™ã€‚

IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå›æ•°ã‚’å•ã„åˆã‚ã›ã¾ã™ã€‚ã“ã“ã§`lru-cache`ã‚’ä½¿ã„ã€1 æ™‚é–“ã« 10 å›ã¾ã§ã®æŠ•ç¨¿ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¨©ã‚’æœ€å¤§ 1000 äººã«ä»˜ä¸ã—ã¾ã™ã€‚ä¸Šé™ã‚ªãƒ¼ãƒãƒ¼ã®å ´åˆã¯ 429 ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã—ã¾ã™ã€‚ä¸Šé™ä»¥å†…ãªã‚‰ã‚«ã‚¦ãƒ³ãƒˆã‚’ +1 ã—ã¦å‡¦ç†ã‚’ç¶šè¡Œã—ã¾ã™ã€‚

```ts
const requestCount = rateLimit.get(ip) || 0;
if (requestCount > 10) {
  return NextResponse.json({ error: 'Too many requests' }, { status: 429 });
}
rateLimit.set(ip, requestCount + 1);
```

ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ reCAPTCHA ã«ã‚ˆã‚‹èªè¨¼çµæœã‚’å•ã„åˆã‚ã›ã¾ã™ã€‚`RECAPTCHA_SECRET_KEY`ã¯ API Route ã§å‘¼ã¶ãŸã‚ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚`data.success = true`ã®å ´åˆã¯å‡¦ç†ã‚’ç¶šè¡Œã—ã€`false`ã®å ´åˆã¯ä¸æ­£ãªé€ä¿¡ãªãŸã‚ 401 ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã—ã¾ã™ã€‚

```ts
const authorize = async (token: string) => {
  const secretKey = `secret=${process.env.RECAPTCHA_SECRET_KEY!}&response=${token}`;
  const data = await fetch("https://www.google.com/recaptcha/api/siteverify", {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded",
    },
    body: secretKey,
  }).then(res => res.json());

  return data;
}
```

å¯¾è±¡ã® Issue ã‚’è¦‹ã¤ã‘ãŸã‚‰ã€ãã®ãƒšãƒ¼ã‚¸ã¸ POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ok ãŒç„¡äº‹è¿”ã•ã‚ŒãŸã‚‰æˆåŠŸã§ã™ã€‚

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã«å¯¾å¿œã§ãã‚‹ã‚ˆã†ã‚¹ã‚¿ãƒ¼ã‚¿ã‚¹ã®åˆ†å²ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚

### ã‚³ãƒ¡ãƒ³ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†

[ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã®è¨­è¨ˆ](#ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã®è¨­è¨ˆ)ã«ã‚‚ã‚ã£ãŸã€ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã®è¨­å®šã§ã™ã€‚

æ³¨æ„ç‚¹ã¨ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã‚’å°é–ã™ã‚‹ã“ã¨ã¯è‡ªç”±ã§ã™ãŒã€**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã«é€ä¿¡/é–²è¦§æ©Ÿèƒ½ã‚’ä¸ãˆãªã„**ã“ã¨ãŒé‡è¦ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€`<Article />`ã®ã‚ˆã†ãªã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§æä¾›ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚

- ãƒ­ãƒƒã‚¯æ©Ÿèƒ½ã§**ã‚³ãƒ¡ãƒ³ãƒˆã®æŠ•ç¨¿è¨±å¯ãƒ»ä¸è¨±å¯**
â†’ reCAPTCHA ã¨æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç„¡ã„ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‘¼ã¶

- ã‚ªãƒ¼ãƒ—ãƒ³/ã‚¯ãƒ­ãƒ¼ã‚ºã§**ã‚³ãƒ¡ãƒ³ãƒˆæ¬„è‡ªä½“ã®æœ‰åŠ¹ãƒ»ç„¡åŠ¹**
â†’ ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè‡ªä½“ã‚’å‘¼ã°ãªã„

`/src/components/layout/ArticlePage.tsx`ã®`{/* ã“ã“ã«ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ */}`ã¸ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff tsx:/src/components/layout/ArticlePage.tsx
export default async function Article({ data, content, issue, slug }: { data: PostData, content: string, issue?: Issue, slug?: string }) {
  const series = data.series ? await getSeries(data.series) : undefined;

  return <article className="w-full">
    <div className="flex items-center">
      <DateCard date={data.date} />
      <h1>{data.title}</h1>
    </div>
    {data.tags ?
      <div className="flex flex-wrap">
        {data.tags?.map((tag, i) =>
          <TagBanner tag={tag} key={i} />)}
      </div> :
      <></>}
    {series ?
      <div>
        <SeriesCard
          slug={data.series}
          index={series.posts.findIndex((item) => item.slug === slug)}
        />
      </div> : <></>}
    <PostMarkdown content={content} />
-   {/* ã“ã“ã«ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ */}
+   {issue && slug ?
+     issue.state === "closed" ?
+       <ExplainingBanner>
+         ã‚³ãƒ¡ãƒ³ãƒˆã¯ç„¡åŠ¹ã§ã™
+       </ExplainingBanner> :
+       issue.locked ?
+         <CommentFormNoPosting comments={issue.comments} /> :
+         <CommentForm comments={issue.comments} slug={slug} /> :
+     <></>}
  </article>
}
```

`closed`ã®å ´åˆã‚’æœ€å„ªå…ˆã¨ã—ã¦æ¡ä»¶åˆ†å²ã‚’ä½œã‚Šã¾ã—ãŸã€‚

![ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ãŒç„¡åŠ¹åŒ–ã•ã‚ŒãŸçŠ¶æ…‹(closed)](/images/next-github-blog-launch/posts-comments_closed.png)
*ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ãŒç„¡åŠ¹åŒ–ã•ã‚ŒãŸçŠ¶æ…‹(closed)*

![æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ãŒç„¡åŠ¹åŒ–ã•ã‚ŒãŸçŠ¶æ…‹(locked)](/images/next-github-blog-launch/posts-comments_locked.png)
*æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ãŒç„¡åŠ¹åŒ–ã•ã‚ŒãŸçŠ¶æ…‹(locked)*

## å®Ÿè£…: ãƒ–ãƒ­ã‚°ã¨ã—ã¦

ãƒ–ãƒ­ã‚°ãªã®ã§ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ã¨ RSS ã‚’å°å…¥ã—ã¾ã™ã€‚ã¾ãŸã€å‹•çš„ã« Metadata ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

### Metadata ã®å®Ÿè£…

`/src/lib/SEO.ts`ã«å…±é€šã§ä»˜ä¸ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é–¢æ•°ã§å®šç¾©ã—ã¾ã™ã€‚

```ts:/src/lib/SEO.ts
interface Props {
  title?: string,
  description?: string,
  url: string,
  imageURL?: string,
  keywords?: string[],
  type?: OpenGraphType,
}

export function generateMetadataTemplate(props: Props): Metadata {
  const { title, description, url, keywords, type } = props;
  const outputTitle = title
    ? `${title} - ${siteName}`
    : siteName;
  const outputDescription = description
    ? description
    : siteDescription;
  const outputType: OpenGraphType = type ? type : "website";

  const metadata: Metadata = {
    metadataBase: new URL(process.env.NEXT_PUBLIC_URL!),
    authors: { name: author.name, url: author.url },
    title: outputTitle,
    description: outputDescription,
    icons: "/favicon.ico",
    keywords,
    openGraph: {
      title: title ? title : siteName,
      description: outputDescription,
      url: url,
      siteName,
      type: outputType,
    },
  };
  return metadata;
}
```

`metadataBase`ã¯ç›¸å¯¾ãƒ‘ã‚¹ã‚’è£œã†ãŸã‚ã«åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚

> metadataBase ã¯ã€å®Œå…¨ä¿®é£¾ URL ã‚’å¿…è¦ã¨ã™ã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ™ãƒ¼ã‚¹ URL ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’è¨­å®šã™ã‚‹ä¾¿åˆ©ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ã€‚ metadataBase ã‚’ä½¿ã†ã¨ã€ç¾åœ¨ã®ãƒ«ãƒ¼ãƒˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆä»¥ä¸‹ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ URL ãƒ™ãƒ¼ã‚¹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã€ãã†ã§ãªã‘ã‚Œã°å¿…é ˆã®çµ¶å¯¾ URL ã®ä»£ã‚ã‚Šã«ç›¸å¯¾ãƒ‘ã‚¹ã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç›¸å¯¾ãƒ‘ã‚¹ã¯ metadataBase ã¨çµ„ã¿åˆã‚ã•ã‚Œã¦ã€å®Œå…¨ä¿®é£¾ URL ã«ãªã‚Šã¾ã™ã€‚ (æ©Ÿæ¢°ç¿»è¨³)

@[card](https://nextjs.org/docs/app/api-reference/functions/generate-metadata#metadatabase)

å„ page.tsx ã§æ¬¡ã®ã‚ˆã†ã«å‘¼ã³å‡ºã—ã¾ã™ã€‚`/src/app/post/[...slug]/page.tsx`ã®å ´åˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```ts:/src/app/post/[...slug]/page.tsx(æŠœç²‹)
export async function generateMetadata({ params }: { params: { slug: string[] } }): Promise<Metadata> {
  const slug = decodeURIComponent(params.slug.join('/'));
  const { data, excerpt } = await getFileContent(slug);

  return generateMetadataTemplate({
    title: `${data.title}`,
    description: `${excerpt}`,
    url: `/post/${params.slug.join('/')}`,
    type: "article",
  });
}
```

### RSS ã®å®Ÿè£…

`/feed`ã§ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ãª RSS ã‚’ä½œæˆã—ã¾ã—ãŸã€‚Google ã«ã‚ˆã‚‹ã¨ RSS ã‚‚ã‚µã‚¤ãƒˆãƒãƒƒãƒ—é€ä¿¡ã«åˆ©ç”¨å¯èƒ½ã¨ã®ã“ã¨ã§ã™ã€‚

@[card](https://developers.google.com/search/docs/crawling-indexing/sitemaps/build-sitemap?hl=ja#rss)

```ts:/src/app/feed/route.ts(æŠœç²‹)
import Rss from 'rss';

export const dynamic = "force-dynamic";
export const revalidate = 1200;

const baseURL = process.env.NEXT_PUBLIC_URL!;

export async function GET() {
  const feed = new Rss({
    title: `${siteName}ã®æ–°ç€æŠ•ç¨¿`,
    description: `ã€Œ${siteName}ã€ã®æŠ•ç¨¿ãƒ•ã‚£ãƒ¼ãƒ‰`,
    feed_url: `${baseURL}/feed`,
    site_url: baseURL,
    language: 'ja'
  });

  const posts = await getPostsProps();

  posts.forEach((post) => feed.item({
    title: post.data.title,
    description: post.excerpt,
    url: `${baseURL}/post/${encodeURIComponent(post.slug)}`,
    date: post.data.date ? new Date(post.data.date).toISOString() : new Date(lastModified).toISOString()
  }))

  return new Response(feed.xml(), {
    headers: {
      'Content-Type': 'application/xml',
      'Cache-Control': `s-maxage=${revalidate}, stale-while-revalidate`
    }
  });
}
```

ã“ã®ã‚ˆã†ã«ã€æŠ•ç¨¿ã‚’å…¨ã¦ã‚¢ã‚¤ãƒ†ãƒ ã¨ã—ã¦è¿½åŠ ã—ã¾ã—ãŸã€‚

### Sitemap ã®å®Ÿè£…

```ts:/src/app/sitemap.ts
export const dynamic = "force-dynamic";
export const revalidate = 0;

const staticPaths = [
  "/post",
  "/profile",
  "/series",
  "/tags"
]

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  const posts = await getPostsProps();
  const tagsWithDate = getTagsWithLatestDate(posts);

  const baseURL = process.env.NEXT_PUBLIC_URL!;

  const staticPages: MetadataRoute.Sitemap = [
    {
      url: baseURL,
      priority: 1.0,
    }
  ];

  staticPaths.forEach((page) => {
    staticPages.push({
      url: baseURL + page,
      priority: 0.9
    })
  })

  const dynamicPages: MetadataRoute.Sitemap = [];

  tagsWithDate.forEach((tagWithDate) => {
    dynamicPages.push({
      url: baseURL + "/tags/" + encodeURIComponent(tagWithDate.tag),
      lastModified: tagWithDate.latestDate ? new Date(tagWithDate.latestDate) : lastModified,
      changeFrequency: "monthly",
      priority: 0.8
    })
  })

  return [...staticPages, ...dynamicPages];
}
```

`staticPaths`ã®é…åˆ—ã‚’å›ã™ã“ã¨ã§å›ºå®šãƒšãƒ¼ã‚¸ã®è¿½åŠ ã‚’è¡Œã„ã¾ã™ã€‚`/tags/[slug]`ã ã‘å‹•çš„ç”Ÿæˆã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸ã¨ã—ã¦è¿½åŠ ã—ã¾ã—ãŸã€‚ãã®éš›ã«ã‚¿ã‚°ã®ä¸­ã§æœ€æ–°ã®æŠ•ç¨¿ã®æ—¥æ™‚ã‚’å–å¾—ã—ã¾ã™ã€‚

> ä¸€éƒ¨ã®ã‚µã‚¤ãƒˆã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¯ã€ã‚µã‚¤ãƒˆä¸Šã®ä»–ã®ãƒšãƒ¼ã‚¸ã‚’é›†ç´„ã—ã¦ã„ã‚‹ã«ã™ããªã„ãŸã‚ã€ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã‚„ã‚«ãƒ†ã‚´ãƒªãƒšãƒ¼ã‚¸ã®æœ€çµ‚æ›´æ–°æ—¥ã‚’åˆ¤æ–­ã™ã‚‹ã®ãŒé›£ã—ã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ãã®ã‚ˆã†ãªå ´åˆã¯ã€ãã®ãƒšãƒ¼ã‚¸ã® lastmod ã‚’é™¤å¤–ã—ã¦ã‚‚ã‹ã¾ã„ã¾ã›ã‚“ã€‚

@[card](https://developers.google.com/search/blog/2023/06/sitemaps-lastmod-ping?hl=ja#the-lastmod-element)

ã¨ã‚ã‚‹ã®ã§ã€`staticPages`ã« lastMod ã¯ä»˜ä¸ã—ãªã„ã“ã¨ã«ã—ã¾ã—ãŸã€‚

## Vercel ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ç’°å¢ƒå¤‰æ•°ã‚’ä¸€åº¦è¦‹ç›´ã™ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ä¾‹ãˆã°`.env.production`ã®`NEXT_PUBLIC_URL`ã¸è‡ªèº«ã®å‰²ã‚Šå½“ã¦ã‚‹äºˆå®šã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚ãã—ã¦ã€`pnpm build`ã‚’å®Ÿè¡Œã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰ã—ã€æˆåŠŸã™ã‚‹ã“ã¨ã‚‚ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

Vercel ã¸ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¨åŒæ™‚ã«ç’°å¢ƒå¤‰æ•°ã‚’æ±ºå®šã—ã¾ã™ã€‚

@[card](https://vercel.com)

GitHub ã«ã‚ã’ãŸè‡ªèº«ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠæ™‚ã« Environment Value ã‚’ç™»éŒ²å¯èƒ½ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```bash:.env*.local
GIT_USERNAME=(YOUR GITHUB USERNAME HERE)
GIT_REPO=(YOUR GITHUB REPOSITORY NAME HERE)
GIT_POSTS_DIR=posts
GIT_IMAGES_DIR=img
GIT_PROFILE_PATH=profile/index.md
GIT_TOKEN=(YOUR PAT HERE)
NEXT_PUBLIC_RECAPTCHA_SITE_KEY=(YOUR TOKEN HERE)
RECAPTCHA_SECRET_KEY=(YOUR TOKEN HERE)
```

`NEXT_PUBLIC_RECAPTCHA_SITE_KEY`ã¯`NEXT_PUBLIC_`ã¨`KEY`ãŒä¸¡æ–¹æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‘ã©å…¬é–‹ã•ã‚Œã¾ã™ã‚ˆï¼Ÿã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã‚ã¨ã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã ã‘ã§ã™ã€‚

## ãŠã‚ã‚Šã«

CSS ã¯ä»Šå›ã®ä¸»é¡Œã§ã¯ãªã„ãŸã‚ã€å‰²æ„›ã„ãŸã—ã¾ã™ã€‚ä½œæˆã—ãŸãƒ–ãƒ­ã‚°ã§ã‚·ãƒªãƒ¼ã‚ºã¨ã—ã¦ã¾ã¨ã‚ãŸã®ã§æ˜¯éå‚ç…§ãã ã•ã„ã€‚

@[card](https://blog.isirmt.com/series/nextjs-gh-blog-css)

ä½•åº¦ã‹ Next.js ã§ã‚µã‚¤ãƒˆã‚’ä½œã‚Šã¾ã—ãŸã€‚å‹•çš„ãƒšãƒ¼ã‚¸ã®è¦ç´ ã‚’ã©ã®ã‚µãƒ¼ãƒãƒ¼ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã«ç½®ã‘ã°ã„ã„ã‹ã¨è©¦è¡ŒéŒ¯èª¤ã—ã¦ã„ã‚‹ç¾çŠ¶ã§ã™ã€‚GitHub API ã®å‘¼ã³å‡ºã—ä¸Šé™ã¯ 5000 å› / hour ã¨ã®è¨˜è¿°ãŒã‚ã‚‹ãŸã‚ã€revalidate ã‚’ 0 ã«ã—ã¦ãŠãã¨ã€å¤šé‡ã‚¢ã‚¯ã‚»ã‚¹ã§ç›´ãã«åˆ©ç”¨ã§ããªããªã‚Šã¾ã™ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ™‚é–“ã‚’èª¿ç¯€ã—ã¤ã¤é©åˆ‡ãªæ›´æ–°é »åº¦ãŒå®Ÿç¾ã—ãŸã„ã§ã™ã­ã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
